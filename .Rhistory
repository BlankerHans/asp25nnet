params$W1 <- params$W1 - tmp$delta
# b1
tmp  <- update_adam(opt$mb1, opt$vb1, grads$db1, beta1, beta2, t_global, lr, eps)
opt$mb1 <- tmp$m; opt$vb1 <- tmp$v
params$b1 <- params$b1 - tmp$delta
# W2
tmp  <- update_adam(opt$mW2, opt$vW2, grads$dW2, beta1, beta2, t_global, lr, eps)
opt$mW2 <- tmp$m; opt$vW2 <- tmp$v
params$W2 <- params$W2 - tmp$delta
# b2
tmp  <- update_adam(opt$mb2, opt$vb2, grads$db2, beta1, beta2, t_global, lr, eps)
opt$mb2 <- tmp$m; opt$vb2 <- tmp$v
params$b2 <- params$b2 - tmp$delta
}
}
# Loss‐Logging
history_train[e] <- mean(batch_losses) # wir berechnen mean of means
if (!is.null(val_split)) {
fwd_val <- forward_onehidden(val_split, params)
history_val[e] <- neg_log_lik(
val_targets,
as.numeric(fwd_val$mu),
as.numeric(fwd_val$log_sigma),
reduction = "mean"
)
message(sprintf(
"Epoch %3d/%d – Train: %.6f | Val: %.6f",
e, epochs, history_train[e], history_val[e]
))
} else {
message(sprintf(
"Epoch %3d/%d – Loss: %.6f",
e, epochs, history_train[e]
))
}
}
out <- list(
params = params,
train_loss = history_train
)
if (!is.null(history_val)) out$val_loss <- history_val
invisible(out)
}
abdom_split <- train_val_test(abdom['x'], normalization=TRUE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
dimensions <- getLayerDimensions(train_loader[[1]]$batch, 2, hidden_neurons = 3)
dimensions <- getLayerDimensions(1, 2, hidden_neurons = 3)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
dimensions <- getLayerDimensions(train_abdom[[1]]$batch, 2, hidden_neurons = 3)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 3)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
abdom_split <- train_val_test(abdom['x'], normalization=TRUE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 3)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="sgd")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets)
abdom_split <- train_val_test(abdom['x'], normalization=TRUE)
load_all()
abdom_split <- train_val_test(abdom['x'], normalization=TRUE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 3)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="sgd")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="sgd", lr=0.0001)
forward_onehidden(abdom['x'], model2$params)
forward_onehidden(t(abdom['x']), model2$params)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
fwd_abdom <- fwd_abdom$y
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
plot(abdom['x'], mu, xlab = "x", ylab = "y_hat", main = "Abdomen Data"))
plot(abdom['x'], mu, xlab = "x", ylab = "y_hat", main = "Abdomen Data")
mu <- fwd_abdom$mu
plot(abdom['x'], mu, xlab = "x", ylab = "y_hat", main = "Abdomen Data")
abdom['x']
mu
class(mu)
class(abdom['x'])
plot(abdom['x'], mu, xlab = "x", ylab = "y_hat", main = "Abdomen Data")
plot(abdom['x'], abdom['y'], xlab = "x", ylab = "y", main = "Abdomen Data")
line(abdom['x'], mu, col = "red", lwd = 2)
plot(abdom['x'], abdom['y'], xlab = "x", ylab = "y", main = "Abdomen Data")
line(abdom['x'], mu, col = "red", lwd = 2)
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
line(abdom['x'], mu, col = "red", lwd = 2)
line(abdom$x, mu, col = "red", lwd = 2)
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
line(abdom$x, mu, col = "red", lwd = 2)
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
line(abdom$x, mu, col = "red", lwd = 2)
lines(abdom$x, mu, col = "red", lwd = 2)
mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 40)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
abdom_split <- train_val_test(abdom['x'], normalization=FALSE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 40)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 50)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
mu
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 40)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
abdom_split <- train_val_test(abdom['x'], normalization=FALSE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 30)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
mu
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 20)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 10)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 50)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam")
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
abdom_split <- train_val_test(abdom['x'], normalization=TRUE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 50)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
mu
abdom_split <- train_val_test(abdom['x'], normalization=FALSE)
abdom_targets <- abdom$y
train_abdom <- abdom_split$train
val_abdom <- abdom_split$validation
val_abdom_targets <- abdom_targets[as.integer(rownames(val_abdom))]
abdom_loader <- DataLoader(train_abdom)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 50)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
model2
summary(model2)
fwd_abdom <- forward_onehidden(t(abdom['x']), model2$params)
mu <- fwd_abdom$mu
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
sigma <- exp(log_sigma)
sigma <- exp(fwd_abdom$log_sigma)
upper <- mu + 1.96 * sigma
lower <- mu - 1.96 * sigma
lines(x, upper, col = "blue", lty = 2)
lines(x, lower, col = "blue", lty = 2)
lines(abdom$x, upper, col = "blue", lty = 2)
lines(abdom$x, lower, col = "blue", lty = 2)
plot(abdom$x, abdom$y, xlab = "x", ylab = "y", main = "Abdomen Data")
lines(abdom$x, mu, col = "red", lwd = 2)
sigma <- exp(fwd_abdom$log_sigma)
upper <- mu + 1.96 * sigma
lower <- mu - 1.96 * sigma
polygon(
c(abdom$x, rev(abdom$x)),
c(upper, rev(lower)),
col = rgb(0.2, 0.2, 1, alpha = 0.2),
border = NA
)
set.seed(42)
n     <- 500
x     <- runif(n, 0, 10)
mu    <- 5 * sin(x)
sigma <- 0.5 + 0.3 * x
eps   <- rnorm(n, 0, sigma)
y     <- mu + eps
df    <- data.frame(x = x, y = y, mu = mu, sigma = sigma)
ord   <- order(df$x)
plot(df$x, df$y, pch = 16, cex = 0.6, xlab = "x", ylab = "y", main = "Nicht‐linear + Heteroskedastisch")
View(df)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
sim_split <- train_val_test(df['x'], normalization=FALSE)
sim_targets <- df$y
train_sim <- sim_split$train
val_sim <- sim_split$validation
val_sim_targets <- sim_targets[as.integer(rownames(val_sim))]
sim_loader <- DataLoader(train_sim)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 50)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
plot(df$x, df$y, pch = 16, cex = 0.6, xlab = "x", ylab = "y", main = "Nicht‐linear + Heteroskedastisch")
lines(df$x, mu, col = "red", lwd = 2)
df['x']
fwd_sim <- forward_onehidden(t(df['x']), model3$params)
mu_sim <- fwd_sim$mu
plot(df$x, df$y, pch = 16, cex = 0.6, xlab = "x", ylab = "y", main = "Nicht‐linear + Heteroskedastisch")
lines(df$x, mu_sim, col = "red", lwd = 2)
sigma <- exp(fwd_sim$log_sigma)
upper <- mu + 1.96 * sigma
lower <- mu - 1.96 * sigma
polygon(
c(df$x, rev(df$x)),
c(upper, rev(lower)),
col = rgb(0.2, 0.2, 1, alpha = 0.2),
border = NA
)
# Sortierindex berechnen
ord <- order(df$x)
plot(df$x, df$y,
pch   = 16,
cex   = 0.6,
xlab  = "x",
ylab  = "y",
main  = "Nicht‐linear + Heteroskedastisch")
lines(df$x[ord], mu_sim[ord],
col = "red",
lwd = 2)
upper <- mu_sim + 1.96 * sigma_sim
lower <- mu_sim - 1.96 * sigma_sim
sigma_sim <- exp(fwd_sim$log_sigma)
upper <- mu_sim + 1.96 * sigma_sim
lower <- mu_sim - 1.96 * sigma_sim
polygon(
x    = c(df$x[ord], rev(df$x[ord])),
y    = c(upper[ord], rev(lower[ord])),
col   = rgb(1, 0, 0, alpha = 0.2),
border = NA
)
load_all()
set.seed(42)
n     <- 500
x     <- runif(n, 0, 10)
mu    <- 5 * sin(x)
sigma <- 0.5 + 0.3 * x
eps   <- rnorm(n, 0, sigma)
y     <- mu + eps
df    <- data.frame(x = x, y = y, mu = mu, sigma = sigma)
ord   <- order(df$x)
plot(df$x, df$y, pch = 16, cex = 0.6, xlab = "x", ylab = "y", main = "Nicht‐linear + Heteroskedastisch")
sim_split <- train_val_test(df['x'], normalization=FALSE)
sim_targets <- df$y
train_sim <- sim_split$train
val_sim <- sim_split$validation
val_sim_targets <- sim_targets[as.integer(rownames(val_sim))]
sim_loader <- DataLoader(train_sim)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 50)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
fwd_sim <- forward_onehidden(t(df['x']), model3$params)
mu_sim <- fwd_sim$mu
sigma_sim <- exp(fwd_sim$log_sigma)
fwd_sim <- forward_onehidden(df['x'], model3$params)
fwd_sim <- forward_onehidden(t(df['x']), model3$params)
mu_sim <- fwd_sim$mu
sigma_sim <- exp(fwd_sim$log_sigma)
# Sortierindex berechnen
ord <- order(df$x)
plot(df$x, df$y,
pch   = 16,
cex   = 0.6,
xlab  = "x",
ylab  = "y",
main  = "Nicht‐linear + Heteroskedastisch")
lines(df$x[ord], mu_sim[ord],
col = "red",
lwd = 2)
upper <- mu_sim + 1.96 * sigma_sim
lower <- mu_sim - 1.96 * sigma_sim
polygon(
x    = c(df$x[ord], rev(df$x[ord])),
y    = c(upper[ord], rev(lower[ord])),
col   = rgb(1, 0, 0, alpha = 0.2),
border = NA
)
set.seed(42)
n <- 500
beta <- 2
sigma0 <- 0.5
# 1) Simuliere x
x <- abs(rnorm(n, mean = 0, sd = 1))
# 2) Berechne für jede x_i die Fehler‐Std-Dev
sigma_x <- sigma0 * x
# 3) Ziehe heteroskedastische Fehler
eps <- rnorm(n, mean = 0, sd = sigma_x)
# 4) Erzeuge y
y <- beta * x + eps
# Kurzer Blick auf Varianz in Abhängigkeit von x
plot(x, y,
xlab = "x",
ylab = "y",
main = "Heteroskedastie")
dataframe <- as.data.frame(cbind(x, y))
View(dataframe)
colnames(dataframe) <- c("unab", "abh")
split <- train_val_test(dataframe["unab"])
train <- split$train
val <- split$val
test <- split$test
nrow(dataframe) == nrow(test)+nrow(train)+nrow(val)
train_loader <- DataLoader(split$train)
targets <- dataframe$abh
val_targets <- targets[as.integer(rownames(val))]
dimensions <- getLayerDimensions(train_loader[[1]]$batch, 2, hidden_neurons = 3)
train_network_val_adam(train_loader, targets, dimensions, t(val), val_targets)
train_network(train_loader,
targets,
dimensions)
install.packages("ellmer")
source("~/Schreibtisch/Studium/ASP/asp25nnet/testing.R")
sim_loader[[1]]$batch
batch <- sim_loader[[1]]$batch
dim(batch)
batch_forward <- forward_onehidden(t(batch), model3$params)
batch_forward <- forward_onehidden(batch, model3$params)
batch_forward
neg_log_lik(yb, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma),reduction = "mean")
batch
sim_loader[[1]]$idx
y_targ <- y[sim_loader[[1]]$idx]
neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma),reduction = "mean")
neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma),reduction = "raw")
mean(neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma),reduction = "raw"))
neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma),reduction = "sum")
numeric(2)
test_hist <- numeric(2)
test_hist[1] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "raw")
test_hist[1] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "sum")
test_hist <- list(2)
test_hist
test_hist[[1]] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "sum")
test_hist
test_hist <- list()
test_hist[[1]] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "raw")
test_hist
test_hist[[2]] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "mean")
test_hist
test_hist <- list()
test_hist[[1]] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "raw")
test_hist
test_hist[[2]] <- neg_log_lik(y_targ, as.numeric(batch_forward$mu), as.numeric(batch_forward$log_sigma), reduction = "raw")
test_hist
mean(test_hist)
load_all()
rlang::last_trace()
source("~/Schreibtisch/Studium/ASP/asp25nnet/testing.R")
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="sgd", epochs=1000)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
model2
summary(model2)
summary(model3)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 10)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
model2
summary(model2)
dimensions <- getLayerDimensions(abdom_loader[[1]]$batch, 2, hidden_neurons = 3)
model2 <- train(abdom_loader, abdom_targets, dimensions, t(val_abdom), val_abdom_targets, optimizer="adam", epochs=1000)
model2
summary(model2)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 50)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 3)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 10)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
set.seed(42)
n     <- 10000
x     <- runif(n, 0, 10)
mu    <- 5 * sin(x)
sigma <- 0.5 + 0.3 * x
eps   <- rnorm(n, 0, sigma)
y     <- mu + eps
df    <- data.frame(x = x, y = y, mu = mu, sigma = sigma)
ord   <- order(df$x)
plot(df$x, df$y, pch = 16, cex = 0.6, xlab = "x", ylab = "y", main = "Nicht‐linear + Heteroskedastisch")
View(df)
sim_split <- random_split(df['x'], normalization=FALSE)
sim_targets <- df$y
train_sim <- sim_split$train
val_sim <- sim_split$validation
val_sim_targets <- sim_targets[as.integer(rownames(val_sim))]
sim_loader <- DataLoader(train_sim)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 10)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
sim_loader <- DataLoader(train_sim, batch_size = 256)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 10)
sim_loader[[1]]$batch
dimensions
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
sim_loader <- DataLoader(train_sim, batch_size = 256)
dimensions <- getLayerDimensions(sim_loader[[1]]$batch, 2, hidden_neurons = 50)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000)
model3
summary(model3)
fwd_sim <- forward_onehidden(t(df['x']), model3$params)
mu_sim <- fwd_sim$mu
sigma_sim <- exp(fwd_sim$log_sigma)
# Sortierindex berechnen
ord <- order(df$x)
plot(df$x, df$y,
pch   = 16,
cex   = 0.6,
xlab  = "x",
ylab  = "y",
main  = "Nicht‐linear + Heteroskedastisch")
lines(df$x[ord], mu_sim[ord],
col = "red",
lwd = 2)
upper
upper <- mu_sim + 1.96 * sigma_sim
lower <- mu_sim - 1.96 * sigma_sim
polygon(
x    = c(df$x[ord], rev(df$x[ord])),
y    = c(upper[ord], rev(lower[ord])),
col   = rgb(1, 0, 0, alpha = 0.2),
border = NA
)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000, lr=0.001)
model3
summary(model3)
model3 <- train(sim_loader, sim_targets, dimensions, t(val_sim), val_sim_targets, optimizer="adam", epochs=1000, lr=0.0001)
model3
summary(model3)
length(10)
devtools::document()
